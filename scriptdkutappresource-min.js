const firebaseConfig={apiKey:"AIzaSyB7pfbXBZTPfQYkwJhZx7-p2S9-9flhdE8",authDomain:"dekutconnect-official.firebaseapp.com",projectId:"dekutconnect-official",storageBucket:"dekutconnect-official.firebasestorage.app",messagingSenderId:"934091852918",appId:"1:934091852918:web:d57dc1a9eb6b24c06d2357",measurementId:"G-YKYK3WFCDF"};firebase.initializeApp(firebaseConfig);const db=firebase.firestore(),storage=firebase.storage(),DATA={schools:[{id:"eng",name:"School of Engineering",icon:"‚öôÔ∏è",programs:["PhD in Mechanical Engineering","PhD in Civil and Environmental Engineering","PhD in Electrical and Electronic Engineering","MSc in Telecommunication Engineering","MSc in Civil Engineering","MSc in Electrical and Electronic Engineering","MSc in Mechanical Engineering","MSc in Biomedical Engineering","BSc in Electrical and Electronic Engineering","BSc in Civil Engineering","BSc in Mechatronic Engineering","BSc in Mechanical Engineering","BSc in Chemical Engineering","BEd in Technology (Electrical)","BSc in Building Construction"]},{id:"bme",name:"School of Business Management and Economics",icon:"üíº",programs:["PhD in Business Administration & Management","Master of Business Administration","Master in Innovation and Entrepreneurship","MSc in Business Analytics","Master in Supply Chain Management","Master in Economics","Master in Project Management","BSc in Purchasing and Supplies Management","BSc in Commerce","BSc in Business Administration","Diploma in Business Administration"]},{id:"csit",name:"School of Computer Science and IT",icon:"üíª",programs:["PhD in Computer Science","MSc in Computer Science","BSc in Computer Science","BSc in Business Information Technology","BSc in Information Technology","Certificate in Fundamentals of ICT"]},{id:"nursing",name:"School of Nursing",icon:"‚öïÔ∏è",programs:["BSc in Nursing (Direct Entry)","BSc in Nursing (Upgrading)"]},{id:"science",name:"School of Science",icon:"üî¨",programs:["PhD in Chemistry","MSc in Applied Statistics","MSc in Leather Technology","MSc in Chemistry","MSc in Industrial Biochemistry","BSc in Industrial Chemistry","BSc in Leather Technology","BSc in Actuarial Science","BSc in Mathematics and Modeling","BSc in Polymer Chemistry","Diploma in Leather Technology"]}],resources:[],currentFilter:"all",currentCourse:null,lastVisible:null,hasMoreResources:!0,resourcesLimit:10,courseLastVisible:{},hasMoreCourseResources:{},courseResourcesCache:{},courseResourcesLimit:10,loadingGlobal:!1,loadingCourse:{},fullSearchCacheTimestamp:null,fullSearchCacheTTL:12e4},UPLOAD_ENDPOINT="https://api.giftedtech.web.id/api/tools/upload";let dropArea=document.getElementById("drop-area"),fileInput=document.getElementById("file-input"),fileInfo=document.getElementById("file-info"),progressBar=document.getElementById("progress-bar"),progressText=document.getElementById("progress-text"),progressContainer=document.getElementById("progress-container"),selectedFile=null;function getResourceIcon(e){return{notes:"üìù",slides:"üìä","past-papers":"üìÑ",books:"üìö",other:"üìé"}[e]||"üìé"}function formatDate(e){if(!e)return"Unknown date";try{if("object"==typeof e&&e.toDate){return e.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}const t=new Date(e);return isNaN(t.getTime())?"Unknown date":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch(e){return"Unknown date"}}function showNotification(e,t="success"){const o=document.getElementById("notification");o&&(o.textContent=e,o.className=`notification ${t}`,o.classList.add("show"),setTimeout((()=>o.classList.remove("show")),3e3))}async function generateFileHash(e){return new Promise((t=>{const o=new FileReader;o.onload=function(o){const r=o.target.result,n=new Uint8Array(r);let s=e.size.toString();const c=Math.min(100,n.length);for(let e=0;e<c;e++)s+=n[e].toString(16).padStart(2,"0");t(s)},o.readAsArrayBuffer(e)}))}async function checkDuplicateFile(e){const t=await generateFileHash(e);return DATA.resources.find((o=>o.fileHash===t&&o.fileName===e.name))}async function uploadFile(e,t){const o=document.getElementById("submitBtn");progressContainer&&(progressContainer.style.display="block"),progressBar&&(progressBar.style.width="0%"),progressText&&(progressText.textContent="0%"),o&&(o.disabled=!0,o.innerHTML='<span class="loading"></span> Uploading...');try{if(await checkDuplicateFile(e))throw new Error("This file has already been uploaded. Please select a different file.");const r=209715200;if(e.size>r)throw new Error("File size exceeds 200MB limit. Please select a smaller file.");const n=[".exe",".scr",".cpl",".jar"],s=e.name.toLowerCase();if(n.some((e=>s.endsWith(e))))throw new Error("This file type is not allowed for security reasons.");const c=new FormData;c.append("file",e);const i=await fetch(UPLOAD_ENDPOINT,{method:"POST",body:c});if(!i.ok)throw new Error(`Upload failed with status: ${i.status}`);const a=await i.json();if(progressBar&&(progressBar.style.width="100%"),progressText&&(progressText.textContent="100%"),a.success&&a.result){const r=await generateFileHash(e),n={title:t.title,type:t.type,program:t.program,course:t.course,code:t.code,description:t.description,fileName:e.name,fileSize:formatFileSize(e.size),fileURL:a.result,fileHash:r,createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp(),downloads:0},s=await db.collection("resources").add(n),c=(await s.get()).data();c.id=s.id,c.createdAt&&c.createdAt.toDate?c.createdAt=c.createdAt.toDate().toISOString():c.createdAt=(new Date).toISOString(),DATA.resources.unshift(c),c.program&&(DATA.courseResourcesCache[c.program]||(DATA.courseResourcesCache[c.program]=[]),DATA.courseResourcesCache[c.program].unshift(c)),renderResources(),showNotification("Resource added successfully!","success");const i=document.getElementById("addResourceForm");return i&&i.reset(),resetDropAreaUI(),progressContainer&&(progressContainer.style.display="none"),closeModal("addModal"),switchTab("resources"),o&&(o.disabled=!1,o.textContent="Add Resource"),c}throw new Error(a.error||"Upload to gifted.web failed")}catch(e){throw showNotification(e.message||"Upload failed. Please try again.","error"),o&&(o.disabled=!1,o.textContent="Add Resource"),progressContainer&&(progressContainer.style.display="none"),e}}function resetDropAreaUI(){const e=document.getElementById("drop-area");e&&(e.innerHTML='\n    <div class="upload-icon">üìÅ</div>\n    <p>Drag & drop files here or click to browse</p>\n    <input type="file" id="file-input" class="file-input" />\n    <div class="file-info" id="file-info"></div>\n  ',dropArea=document.getElementById("drop-area"),fileInput=document.getElementById("file-input"),fileInfo=document.getElementById("file-info"),["dragenter","dragover","dragleave","drop"].forEach((e=>{dropArea&&dropArea.addEventListener(e,(e=>{e.preventDefault(),e.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((e=>{dropArea&&dropArea.addEventListener(e,(()=>dropArea.classList.add("active")))})),["dragleave","drop"].forEach((e=>{dropArea&&dropArea.addEventListener(e,(()=>dropArea.classList.remove("active")))})),dropArea&&(dropArea.addEventListener("drop",(e=>handleFiles(e.dataTransfer.files))),dropArea.addEventListener("click",(()=>fileInput&&fileInput.click()))),fileInput&&fileInput.addEventListener("change",(e=>handleFiles(e.target.files))))}function handleFiles(e){e.length>0&&(selectedFile=e[0],fileInfo&&(fileInfo.textContent=`${selectedFile.name} (${(selectedFile.size/1024/1024).toFixed(2)} MB)`))}function renderSchools(){const e=document.getElementById("schoolsGrid");e&&(e.innerHTML="",DATA.schools.forEach((t=>{const o=document.createElement("div");o.className="card",o.innerHTML=`\n      <h3>\n        <span>${t.icon} ${t.name}</span>\n        <span class="badge">${t.programs.length}</span>\n      </h3>\n      <p>${t.programs.length} programs available</p>\n    `,o.addEventListener("click",(()=>showSchoolDetails(t))),e.appendChild(o)})))}function showSchoolDetails(e){const t=document.getElementById("schoolModal"),o=document.getElementById("schoolModalTitle"),r=document.getElementById("schoolModalContent");if(!t||!o||!r)return;o.textContent=e.name;const n=document.createElement("div");n.style.marginBottom="16px";const s=document.createElement("p");s.style.color="var(--muted)",s.textContent=`${e.programs.length} programs in this school`,n.appendChild(s);const c=document.createElement("div");c.className="resource-list",e.programs.forEach((e=>{const o=document.createElement("div");o.className="resource-item",o.style.cursor="pointer",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.padding="8px 0";const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center";const n=document.createElement("div");n.className="resource-icon",n.textContent="üéì",n.style.marginRight="12px";const s=document.createElement("div");s.className="resource-content";const i=document.createElement("div");i.className="resource-title",i.textContent=e;const a=document.createElement("div");a.className="resource-meta",a.textContent=`${getProgramResourcesCount(e)} resources available`,s.appendChild(i),s.appendChild(a),r.appendChild(n),r.appendChild(s);const d=document.createElement("button");d.className="btn",d.textContent="Open",d.addEventListener("click",(o=>{o.stopPropagation(),showProgramResources(e),t.classList.remove("show")})),o.appendChild(r),o.appendChild(d),o.addEventListener("click",(()=>{showProgramResources(e),t.classList.remove("show")})),c.appendChild(o)})),r.innerHTML="",r.appendChild(n),r.appendChild(c),t.classList.add("show")}function getProgramResourcesCount(e){return(DATA.courseResourcesCache[e]||[]).length}function showProgramResources(e){if(!e)return void showNotification("Invalid program selected","error");DATA.currentCourse=e;const t=document.getElementById("courseResourcesTitle");t&&(t.textContent=`${e} Resources`),document.querySelectorAll(".section").forEach((e=>e.style.display="none"));const o=document.getElementById("courseResourcesSection");o&&(o.style.display="block"),void 0===DATA.hasMoreCourseResources[e]&&(DATA.hasMoreCourseResources[e]=!0,DATA.courseLastVisible[e]=null,DATA.courseResourcesCache[e]=[]),(DATA.courseResourcesCache[e]||[]).length>0?(renderCourseResources(!1),loadCourseResources(e,!1).catch((e=>{}))):loadCourseResources(e,!1).catch((e=>{})),closeModal("schoolModal")}function renderCourseResources(e=!1){const t=document.getElementById("courseResourcesList"),o=DATA.currentCourse;if(!t||!o)return;const r=DATA.courseResourcesCache[o]||[];if(e||(t.innerHTML=""),0===r.length&&!e){t.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-icon">üìö</div>\n        <h3>No resources yet for this program</h3>\n        <p>Be the first to add a resource!</p>\n        <button class="btn" id="addResourceFromCourseBtn">Add Resource</button>\n      </div>\n    ';const e=document.getElementById("addResourceFromCourseBtn");e&&e.addEventListener("click",openAddModal);const o=document.getElementById("courseResourcesLoadMore");return void(o&&(o.style.display="none"))}const n="all"===DATA.currentFilter?r:r.filter((e=>e.type===DATA.currentFilter));if(0===n.length&&!e){t.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-icon">üîç</div>\n        <h3>No resources match your filter</h3>\n        <p>Try a different filter or add a resource</p>\n        <button class="btn" id="addResourceFromCourseBtn2">Add Resource</button>\n      </div>\n    ';const e=document.getElementById("addResourceFromCourseBtn2");e&&e.addEventListener("click",openAddModal);const o=document.getElementById("courseResourcesLoadMore");return void(o&&(o.style.display="none"))}if(e){const e=t.querySelectorAll(".resource-item").length;n.slice(e,e+DATA.courseResourcesLimit).forEach((e=>appendCourseResourceItem(t,e)))}else{n.slice(0,DATA.courseResourcesLimit).forEach((e=>appendCourseResourceItem(t,e)))}const s=document.getElementById("courseResourcesLoadMore");n.length>t.querySelectorAll(".resource-item").length?s&&(s.style.display="block"):s&&(s.style.display="none")}function appendCourseResourceItem(e,t){const o=document.createElement("div");o.className="resource-item",o.innerHTML=`\n    <div class="resource-icon">${getResourceIcon(t.type)}</div>\n    <div class="resource-content">\n      <div class="resource-title">${t.title}</div>\n      <div class="resource-meta">${t.course||""} ‚Ä¢ ${t.program||""} ‚Ä¢ ${formatDate(t.createdAt)}</div>\n      <div class="resource-actions">\n        <button class="btn btn-small view-btn">View</button>\n        <button class="btn-secondary btn-small download-btn">Download</button>\n      </div>\n    </div>\n  `;const r=o.querySelector(".view-btn"),n=o.querySelector(".download-btn");r&&r.addEventListener("click",(e=>{e.stopPropagation(),viewResource(t.id)})),n&&n.addEventListener("click",(e=>{e.stopPropagation(),downloadResource(t.id)})),e.appendChild(o)}function renderResources(e=!1){const t=document.getElementById("resourcesList");if(!t)return;if(e||(t.innerHTML=""),0===DATA.resources.length&&!e){t.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-icon">üìö</div>\n        <h3>No resources yet</h3>\n        <p>Be the first to add a resource!</p>\n        <button class="btn" id="addResourceMainBtn">Add Resource</button>\n      </div>\n    ';const e=document.getElementById("addResourceMainBtn");e&&e.addEventListener("click",openAddModal);const o=document.getElementById("resourcesLoadMore");return void(o&&(o.style.display="none"))}const o="all"===DATA.currentFilter?DATA.resources:DATA.resources.filter((e=>e.type===DATA.currentFilter));if(0===o.length&&!e){t.innerHTML='\n      <div class="empty-state">\n        <div class="empty-state-icon">üîç</div>\n        <h3>No resources match your filter</h3>\n        <p>Try a different filter or add a resource</p>\n        <button class="btn" id="addResourceMainBtn2">Add Resource</button>\n      </div>\n    ';const e=document.getElementById("addResourceMainBtn2");e&&e.addEventListener("click",openAddModal);const o=document.getElementById("resourcesLoadMore");return void(o&&(o.style.display="none"))}const r=t.querySelectorAll(".resource-item").length;o.slice(r,r+DATA.resourcesLimit).forEach((e=>{const o=document.createElement("div");o.className="resource-item",o.style.cursor="pointer",o.addEventListener("click",(()=>{e.program&&showProgramResources(e.program)})),o.innerHTML=`\n      <div class="resource-icon">${getResourceIcon(e.type)}</div>\n      <div class="resource-content">\n        <div class="resource-title">${e.title}</div>\n        <div class="resource-meta">${e.course||""} ‚Ä¢ ${e.program||""} ‚Ä¢ ${formatDate(e.createdAt)}</div>\n        <div class="resource-actions">\n          <button class="btn btn-small view-btn">View</button>\n          <button class="btn-secondary btn-small download-btn">Download</button>\n        </div>\n      </div>\n    `;const r=o.querySelector(".view-btn"),n=o.querySelector(".download-btn");r&&r.addEventListener("click",(t=>{t.stopPropagation(),viewResource(e.id)})),n&&n.addEventListener("click",(t=>{t.stopPropagation(),downloadResource(e.id)})),t.appendChild(o)}));const n=document.getElementById("resourcesLoadMore");o.length>t.querySelectorAll(".resource-item").length?n&&(n.style.display="block"):n&&(n.style.display="none")}function switchTab(e){document.querySelectorAll(".tab").forEach((e=>e.classList.remove("active")));const t=document.querySelector(`[data-tab="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".section").forEach((e=>e.style.display="none"));const o={schools:"schoolsSection",resources:"resourcesSection",elearning:"elearningSection"}[e];if(o){const e=document.getElementById(o);e&&(e.style.display="block")}}function openAddModal(){const e=document.getElementById("addModal");e&&e.classList.add("show"),populateSchoolDropdown()}function closeModal(e){const t=document.getElementById(e);t&&t.classList.remove("show")}function populateSchoolDropdown(){const e=document.getElementById("resourceSchool");e&&(e.innerHTML='<option value="">Select school</option>',DATA.schools.forEach((t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.name,e.appendChild(o)})))}function updateProgramDropdown(e){const t=document.getElementById("resourceProgram");if(!t)return;if(t.innerHTML='<option value="">Select program</option>',!e)return;const o=DATA.schools.find((t=>t.id===e));o&&o.programs.forEach((e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}))}function formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}async function loadResources(e=!1){if(!DATA.loadingGlobal){DATA.loadingGlobal=!0;try{let t=db.collection("resources").orderBy("createdAt","desc").limit(DATA.resourcesLimit);if(e&&DATA.lastVisible)t=t.startAfter(DATA.lastVisible);else if(e&&!DATA.lastVisible)return void(DATA.loadingGlobal=!1);const o=await t.get();e||(DATA.resources=[]),o.forEach((e=>{const t=e.data();t.id=e.id,t.createdAt&&t.createdAt.toDate?t.createdAt=t.createdAt.toDate().toISOString():t.createdAt||(t.createdAt=(new Date).toISOString()),DATA.resources.some((e=>e.id===t.id))||DATA.resources.push(t)})),o.docs.length>0?(DATA.lastVisible=o.docs[o.docs.length-1],DATA.hasMoreResources=o.docs.length===DATA.resourcesLimit):DATA.hasMoreResources=!1,renderResources(e)}catch(e){showNotification("Error loading resources","error")}finally{DATA.loadingGlobal=!1}}}async function loadCourseResources(e,t=!1){if(e&&(DATA.loadingCourse[e]||(DATA.loadingCourse[e]=!1),!DATA.loadingCourse[e])){DATA.loadingCourse[e]=!0;try{let o=db.collection("resources").where("program","==",e).orderBy("createdAt","desc").limit(DATA.courseResourcesLimit);if(t&&DATA.courseLastVisible[e])o=o.startAfter(DATA.courseLastVisible[e]);else if(t&&!DATA.courseLastVisible[e])return void(DATA.loadingCourse[e]=!1);const r=await o.get();t||(DATA.courseResourcesCache[e]=[]),r.forEach((t=>{const o=t.data();o.id=t.id,o.createdAt&&o.createdAt.toDate?o.createdAt=o.createdAt.toDate().toISOString():o.createdAt||(o.createdAt=(new Date).toISOString()),DATA.courseResourcesCache[e].some((e=>e.id===o.id))||DATA.courseResourcesCache[e].push(o),DATA.resources.some((e=>e.id===o.id))||DATA.resources.push(o)})),r.docs.length>0?(DATA.courseLastVisible[e]=r.docs[r.docs.length-1],DATA.hasMoreCourseResources[e]=r.docs.length===DATA.courseResourcesLimit):DATA.hasMoreCourseResources[e]=!1,renderCourseResources(t)}catch(e){showNotification("Error loading program resources","error")}finally{DATA.loadingCourse[e]=!1}}}function filterResourcesByQuery(e,t){const o=t.toLowerCase();return e.filter((e=>e.title&&e.title.toLowerCase().includes(o)||e.code&&e.code.toLowerCase().includes(o)||e.course&&e.course.toLowerCase().includes(o)||e.program&&e.program.toLowerCase().includes(o)||e.description&&e.description.toLowerCase().includes(o)))}async function fetchAllResourcesFromFirestore(){const e=[];let t=null;for(;;){let o=db.collection("resources").orderBy("createdAt","desc").limit(500);t&&(o=o.startAfter(t));const r=await o.get();if(r.empty)break;if(r.forEach((t=>{const o=t.data();o.id=t.id,o.createdAt&&o.createdAt.toDate?o.createdAt=o.createdAt.toDate().toISOString():o.createdAt||(o.createdAt=(new Date).toISOString()),e.push(o)})),t=r.docs[r.docs.length-1],r.docs.length<500)break}return e}async function performSearch(){const e=document.getElementById("searchInput"),t=e?e.value.toLowerCase().trim():"";if(!t)return renderSchools(),void renderResources();filterResourcesByQuery(DATA.resources,t);const o=Date.now();let r=[];if(DATA.fullSearchCacheTimestamp&&o-DATA.fullSearchCacheTimestamp<DATA.fullSearchCacheTTL)r=DATA.resources.slice();else{showNotification("Searching all resources ‚Äî this may take a moment...","success");try{r=await fetchAllResourcesFromFirestore(),DATA.fullSearchCacheTimestamp=Date.now(),r.forEach((e=>{DATA.resources.some((t=>t.id===e.id))||DATA.resources.push(e)}))}catch(e){return void showNotification("Search failed (could not fetch all resources)","error")}}showSearchResults([],filterResourcesByQuery(r,t),t)}function showSearchResults(e,t,o){switchTab("resources");const r=document.getElementById("resourcesList");r&&(r.innerHTML=`<h3 style="margin-bottom: 16px;">Search results for "${o}"</h3>`,e&&0!==e.length||t&&0!==t.length?(e&&e.length>0&&(r.innerHTML+=`<h4 style="margin: 20px 0 12px; color: var(--muted);">Schools (${e.length})</h4>`,e.forEach((e=>{const t=document.createElement("div");t.className="resource-item",t.style.cursor="pointer",t.innerHTML=`\n        <div class="resource-icon">${e.icon}</div>\n        <div class="resource-content">\n          <div class="resource-title">${e.name}</div>\n          <div class="resource-meta">${e.programs.length} programs</div>\n        </div>\n      `,t.addEventListener("click",(()=>showSchoolDetails(e))),r.appendChild(t)}))),t&&t.length>0&&(r.innerHTML+=`<h4 style="margin: 20px 0 12px; color: var(--muted);">Resources (${t.length})</h4>`,t.forEach((e=>{const t=document.createElement("div");t.className="resource-item",t.style.cursor="pointer",t.addEventListener("click",(()=>{e.program&&showProgramResources(e.program)})),t.innerHTML=`\n        <div class="resource-icon">${getResourceIcon(e.type)}</div>\n        <div class="resource-content">\n          <div class="resource-title">${e.title}</div>\n          <div class="resource-meta">${e.course||""} ‚Ä¢ ${e.program||""} ‚Ä¢ ${e.code||""}</div>\n          <div class="resource-actions">\n            <button class="btn btn-small view-btn">View</button>\n            <button class="btn-secondary btn-small download-btn">Download</button>\n          </div>\n        </div>\n      `;const o=t.querySelector(".view-btn"),n=t.querySelector(".download-btn");o&&o.addEventListener("click",(t=>{t.stopPropagation(),viewResource(e.id)})),n&&n.addEventListener("click",(t=>{t.stopPropagation(),downloadResource(e.id)})),r.appendChild(t)})))):r.innerHTML+='\n      <div class="empty-state">\n        <div class="empty-state-icon">üîç</div>\n        <h3>No results found</h3>\n        <p>Try different keywords</p>\n      </div>\n    ')}function viewResource(e){const t=DATA.resources.find((t=>t.id===e))||Object.values(DATA.courseResourcesCache).flat().find((t=>t.id===e));t&&t.fileURL?window.open(t.fileURL,"_blank"):showNotification("Resource not available","error")}function downloadResource(e){const t=DATA.resources.find((t=>t.id===e))||Object.values(DATA.courseResourcesCache).flat().find((t=>t.id===e));if(t&&t.fileURL){const o=document.createElement("a");o.href=t.fileURL,o.download=t.fileName||"resource",document.body.appendChild(o),o.click(),document.body.removeChild(o),db.collection("resources").doc(e).update({downloads:firebase.firestore.FieldValue.increment(1),updatedAt:firebase.firestore.FieldValue.serverTimestamp()}).catch((e=>{})),t.downloads=(t.downloads||0)+1,showNotification("Download started","success")}else showNotification("Resource not available","error")}function applyResourceFilter(e){DATA.currentFilter=e,document.querySelectorAll(".filter-btn").forEach((e=>e.classList.remove("active")));const t=document.querySelector(`[data-type="${e}"]`);t&&t.classList.add("active");const o=document.getElementById("courseResourcesSection");o&&"none"!==o.style.display?renderCourseResources():renderResources()}let scrollListenerAttached=!1;function attachInfiniteScroll(){scrollListenerAttached||(scrollListenerAttached=!0,window.addEventListener("scroll",(()=>{if(!(window.innerHeight+window.scrollY>=document.body.offsetHeight-300))return;const e=document.getElementById("courseResourcesSection"),t=document.getElementById("resourcesSection");if(e&&"none"!==e.style.display){const e=DATA.currentCourse;e&&DATA.hasMoreCourseResources[e]&&loadCourseResources(e,!0).catch((e=>{}))}else t&&"none"!==t.style.display&&DATA.hasMoreResources&&loadResources(!0).catch((e=>{}))})))}function init(){renderSchools(),loadResources().catch((e=>{})),attachInfiniteScroll(),document.querySelectorAll(".tab").forEach((e=>{e.addEventListener("click",(()=>switchTab(e.dataset.tab)))}));const e=document.getElementById("quickAddBtn");e&&e.addEventListener("click",openAddModal);const t=document.getElementById("closeModalBtn");t&&t.addEventListener("click",(()=>closeModal("addModal")));const o=document.getElementById("closeSchoolModalBtn");o&&o.addEventListener("click",(()=>closeModal("schoolModal"))),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&e.classList.remove("show")}))}));const r=document.getElementById("searchBtn");r&&r.addEventListener("click",performSearch);const n=document.getElementById("searchInput");n&&n.addEventListener("keypress",(e=>{"Enter"===e.key&&performSearch()}));const s=document.getElementById("resourceSchool");s&&s.addEventListener("change",(e=>updateProgramDropdown(e.target.value))),dropArea&&(["dragenter","dragover","dragleave","drop"].forEach((e=>{dropArea.addEventListener(e,(e=>{e.preventDefault(),e.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((e=>dropArea.addEventListener(e,(()=>dropArea.classList.add("active"))))),["dragleave","drop"].forEach((e=>dropArea.addEventListener(e,(()=>dropArea.classList.remove("active"))))),dropArea.addEventListener("drop",(e=>handleFiles(e.dataTransfer.files))),dropArea.addEventListener("click",(()=>fileInput&&fileInput.click()))),fileInput&&fileInput.addEventListener("change",(e=>handleFiles(e.target.files)));const c=document.getElementById("addResourceForm");c&&c.addEventListener("submit",(async e=>{if(e.preventDefault(),!selectedFile)return void showNotification("Please select a file","error");const t={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,program:document.getElementById("resourceProgram").value,course:document.getElementById("resourceCourse").value,code:document.getElementById("resourceCode").value,description:document.getElementById("resourceDescription").value};if(t.title&&t.type&&t.program&&t.course)try{await uploadFile(selectedFile,t)}catch(e){}else showNotification("Please fill all required fields","error")})),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(()=>applyResourceFilter(e.dataset.type)))})),document.querySelectorAll("#courseResourceFilters .filter-btn").forEach((e=>{e.addEventListener("click",(()=>{DATA.currentFilter=e.dataset.type,document.querySelectorAll("#courseResourceFilters .filter-btn").forEach((e=>e.classList.remove("active"))),e.classList.add("active"),renderCourseResources()}))}));const i=document.getElementById("backToResourcesBtn");i&&i.addEventListener("click",(()=>{const e=document.getElementById("courseResourcesSection"),t=document.getElementById("resourcesSection");e&&(e.style.display="none"),t&&(t.style.display="block"),DATA.currentCourse=null}));const a=document.getElementById("resourcesLoadMore");a&&a.addEventListener("click",(()=>loadResources(!0)));const d=document.getElementById("courseResourcesLoadMore");d&&d.addEventListener("click",(()=>{DATA.currentCourse&&loadCourseResources(DATA.currentCourse,!0)})),showNotification("Welcome to DKUT Resource Centre!","success")}document.addEventListener("DOMContentLoaded",init);
