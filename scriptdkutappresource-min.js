const firebaseConfig={apiKey:"AIzaSyB7pfbXBZTPfQYkwJhZx7-p2S9-9flhdE8",authDomain:"dekutconnect-official.firebaseapp.com",projectId:"dekutconnect-official",storageBucket:"dekutconnect-official.firebasestorage.app",messagingSenderId:"934091852918",appId:"1:934091852918:web:d57dc1a9eb6b24c06d2357",measurementId:"G-YKYK3WFCDF"};firebase.initializeApp(firebaseConfig);const db=firebase.firestore(),storage=firebase.storage(),DATA={schools:[{id:"eng",name:"School of Engineering",icon:"‚öôÔ∏è",programs:["PhD in Mechanical Engineering","PhD in Civil and Environmental Engineering","PhD in Electrical and Electronic Engineering","MSc in Telecommunication Engineering","MSc in Civil Engineering","MSc in Electrical and Electronic Engineering","MSc in Mechanical Engineering","MSc in Biomedical Engineering","BSc in Electrical and Electronic Engineering","BSc in Civil Engineering","BSc in Mechatronic Engineering","BSc in Mechanical Engineering","BSc in Chemical Engineering","BEd in Technology (Electrical)","BSc in Building Construction"]},{id:"bme",name:"School of Business Management and Economics",icon:"üíº",programs:["PhD in Business Administration & Management","Master of Business Administration","Master in Innovation and Entrepreneurship","MSc in Business Analytics","Master in Supply Chain Management","Master in Economics","Master in Project Management","BSc in Purchasing and Supplies Management","BSc in Commerce","BSc in Business Administration","Diploma in Business Administration"]},{id:"csit",name:"School of Computer Science and IT",icon:"üíª",programs:["PhD in Computer Science","MSc in Computer Science","BSc in Computer Science","BSc in Business Information Technology","BSc in Information Technology","Certificate in Fundamentals of ICT"]},{id:"nursing",name:"School of Nursing",icon:"‚öïÔ∏è",programs:["BSc in Nursing (Direct Entry)","BSc in Nursing (Upgrading)"]},{id:"science",name:"School of Science",icon:"üî¨",programs:["PhD in Chemistry","MSc in Applied Statistics","MSc in Leather Technology","MSc in Chemistry","MSc in Industrial Biochemistry","BSc in Industrial Chemistry","BSc in Leather Technology","BSc in Actuarial Science","BSc in Mathematics and Modeling","BSc in Polymer Chemistry","Diploma in Leather Technology"]}],resources:[],currentFilter:"all",currentCourse:null,lastVisible:null,hasMoreResources:!0,resourcesLimit:10,courseResourcesLimit:10},UPLOAD_ENDPOINT="https://api.giftedtech.web.id/api/tools/upload",dropArea=document.getElementById("drop-area"),fileInput=document.getElementById("file-input"),fileInfo=document.getElementById("file-info"),progressBar=document.getElementById("progress-bar"),progressText=document.getElementById("progress-text"),progressContainer=document.getElementById("progress-container");let selectedFile=null;function getResourceIcon(e){return{notes:"üìù",slides:"üìä","past-papers":"üìÑ",books:"üìö",other:"üìé"}[e]||"üìé"}function formatDate(e){if(!e)return"Unknown date";try{if("object"==typeof e&&e.toDate){return e.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}const t=new Date(e);return isNaN(t.getTime())?"Unknown date":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch(e){return"Unknown date"}}function showNotification(e,t="success"){const n=document.getElementById("notification");n.textContent=e,n.className=`notification ${t}`,n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),3e3)}async function generateFileHash(e){return new Promise((t=>{const n=new FileReader;n.onload=function(n){const o=n.target.result,s=new Uint8Array(o);let r=e.size.toString();const i=Math.min(100,s.length);for(let e=0;e<i;e++)r+=s[e].toString(16).padStart(2,"0");t(r)},n.readAsArrayBuffer(e)}))}async function checkDuplicateFile(e){const t=await generateFileHash(e);return DATA.resources.find((n=>n.fileHash===t&&n.fileName===e.name))}async function uploadFile(e,t){const n=document.getElementById("submitBtn");progressContainer.style.display="block",progressBar.style.width="0%",progressText.textContent="0%",n.disabled=!0,n.innerHTML='<span class="loading"></span> Uploading...';try{if(await checkDuplicateFile(e))throw new Error("This file has already been uploaded. Please select a different file.");const n=209715200;if(e.size>n)throw new Error("File size exceeds 200MB limit. Please select a smaller file.");const o=[".exe",".scr",".cpl",".jar"],s=e.name.toLowerCase();if(o.some((e=>s.endsWith(e))))throw new Error("This file type is not allowed for security reasons.");const r=new FormData;r.append("file",e);const i=await fetch(UPLOAD_ENDPOINT,{method:"POST",body:r});if(!i.ok)throw new Error(`Upload failed with status: ${i.status}`);const c=await i.json();if(progressBar.style.width="100%",progressText.textContent="100%",c.success&&c.result){const n=await generateFileHash(e),o={title:t.title,type:t.type,school:t.school,program:t.program,course:t.course,code:t.code,description:t.description,fileName:e.name,fileSize:formatFileSize(e.size),fileURL:c.result,fileHash:n,createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp(),downloads:0},s=await db.collection("resources").add(o),r=(await s.get()).data(),i={...r,id:s.id,createdAt:r.createdAt&&r.createdAt.toDate?r.createdAt.toDate().toISOString():(new Date).toISOString()};return DATA.resources.unshift(i),renderResources(),showNotification("Resource added successfully!","success"),document.getElementById("addResourceForm").reset(),dropArea.innerHTML='\n            <div class="upload-icon">üìÅ</div>\n            <p>Drag & drop files here or click to browse</p>\n            <input type="file" id="file-input" class="file-input" />\n            <div class="file-info" id="file-info"></div>\n          ',progressContainer.style.display="none",closeModal("addModal"),switchTab("resources"),i}throw new Error(c.error||"Upload to gifted.web failed")}catch(e){throw showNotification(e.message||"Upload failed. Please try again.","error"),n.disabled=!1,n.textContent="Add Resource",progressContainer.style.display="none",e}}function renderSchools(){const e=document.getElementById("schoolsGrid");e.innerHTML="",DATA.schools.forEach((t=>{const n=document.createElement("div");n.className="card",n.innerHTML=`\n          <h3>\n            <span>${t.icon} ${t.name}</span>\n            <span class="badge">${t.programs.length}</span>\n          </h3>\n          <p>${t.programs.length} programs available</p>\n        `,n.addEventListener("click",(()=>showSchoolDetails(t))),e.appendChild(n)}))}function showSchoolDetails(e){const t=document.getElementById("schoolModal"),n=document.getElementById("schoolModalTitle"),o=document.getElementById("schoolModalContent");n.textContent=e.name,o.innerHTML=`\n        <div style="margin-bottom: 16px;">\n          <p style="color: var(--muted);">${e.programs.length} programs in this school</p>\n        </div>\n        <div class="resource-list">\n          ${e.programs.map((e=>`\n            <div class="resource-item" style="cursor: pointer;" onclick="showProgramResources('${e}')">\n              <div class="resource-icon">üéì</div>\n              <div class="resource-content">\n                <div class="resource-title">${e}</div>\n                <div class="resource-meta">${getProgramResourcesCount(e)} resources available</div>\n              </div>\n            </div>\n          `)).join("")}\n        </div>\n      `,t.classList.add("show")}function getProgramResourcesCount(e){return DATA.resources.filter((t=>t.program===e)).length}function showProgramResources(e){DATA.currentCourse=e,document.getElementById("courseResourcesTitle").textContent=`${e} Resources`,document.querySelectorAll(".section").forEach((e=>{e.style.display="none"})),document.getElementById("courseResourcesSection").style.display="block",renderCourseResources(),closeModal("schoolModal")}function renderCourseResources(e=!1){const t=document.getElementById("courseResourcesList");if(e||(t.innerHTML="",DATA.courseResourcesLastVisible=null,DATA.hasMoreCourseResources=!0),!e&&0===DATA.resources.length)return void(t.innerHTML='\n          <div class="resource-item">\n            <div class="resource-icon skeleton"></div>\n            <div class="resource-content">\n              <div class="skeleton skeleton-title"></div>\n              <div class="skeleton skeleton-text" style="width: 70%"></div>\n              <div class="skeleton skeleton-text" style="width: 50%"></div>\n            </div>\n          </div>\n          <div class="resource-item">\n            <div class="resource-icon skeleton"></div>\n            <div class="resource-content">\n              <div class="skeleton skeleton-title"></div>\n              <div class="skeleton skeleton-text" style="width: 70%"></div>\n              <div class="skeleton skeleton-text" style="width: 50%"></div>\n            </div>\n          </div>\n        ');const n=DATA.resources.filter((e=>e.program===DATA.currentCourse));if(0===n.length&&!e)return t.innerHTML='\n          <div class="empty-state">\n            <div class="empty-state-icon">üìö</div>\n            <h3>No resources yet for this program</h3>\n            <p>Be the first to add a resource!</p>\n            <button class="btn" onclick="openAddModal()">Add Resource</button>\n          </div>\n        ',void(document.getElementById("courseResourcesLoadMore").style.display="none");const o="all"===DATA.currentFilter?n:n.filter((e=>e.type===DATA.currentFilter));if(0===o.length&&!e)return t.innerHTML='\n          <div class="empty-state">\n            <div class="empty-state-icon">üîç</div>\n            <h3>No resources match your filter</h3>\n            <p>Try a different filter or add a resource</p>\n            <button class="btn" onclick="openAddModal()">Add Resource</button>\n          </div>\n        ',void(document.getElementById("courseResourcesLoadMore").style.display="none");const s=e?o.slice(2*-DATA.courseResourcesLimit):o.slice(0,DATA.courseResourcesLimit);s.forEach((e=>{const n=document.createElement("div");n.className="resource-item",n.innerHTML=`\n          <div class="resource-icon">${getResourceIcon(e.type)}</div>\n          <div class="resource-content">\n            <div class="resource-title">${e.title}</div>\n            <div class="resource-meta">${e.course} ‚Ä¢ ${e.program} ‚Ä¢ ${formatDate(e.createdAt)}</div>\n            <div class="resource-actions">\n              <button class="btn btn-small" onclick="viewResource('${e.id}')">View</button>\n              <button class="btn-secondary btn-small" onclick="downloadResource('${e.id}')">Download</button>\n            </div>\n          </div>\n        `,t.appendChild(n)}));const r=document.getElementById("courseResourcesLoadMore");o.length>s.length?r.style.display="block":r.style.display="none"}function renderResources(e=!1){const t=document.getElementById("resourcesList");if(e||(t.innerHTML="",DATA.lastVisible=null,DATA.hasMoreResources=!0),0===DATA.resources.length&&!e)return t.innerHTML='\n          <div class="empty-state">\n            <div class="empty-state-icon">üìö</div>\n            <h3>No resources yet</h3>\n            <p>Be the first to add a resource!</p>\n            <button class="btn" onclick="openAddModal()">Add Resource</button>\n          </div>\n        ',void(document.getElementById("resourcesLoadMore").style.display="none");const n="all"===DATA.currentFilter?DATA.resources:DATA.resources.filter((e=>e.type===DATA.currentFilter));if(0===n.length&&!e)return t.innerHTML='\n          <div class="empty-state">\n            <div class="empty-state-icon">üîç</div>\n            <h3>No resources match your filter</h3>\n            <p>Try a different filter or add a resource</p>\n            <button class="btn" onclick="openAddModal()">Add Resource</button>\n          </div>\n        ',void(document.getElementById("resourcesLoadMore").style.display="none");const o=e?n.slice(2*-DATA.resourcesLimit):n.slice(0,DATA.resourcesLimit);o.forEach((e=>{const n=document.createElement("div");n.className="resource-item",n.style.cursor="pointer",n.addEventListener("click",(()=>showProgramResources(e.program))),n.innerHTML=`\n          <div class="resource-icon">${getResourceIcon(e.type)}</div>\n          <div class="resource-content">\n            <div class="resource-title">${e.title}</div>\n            <div class="resource-meta">${e.course} ‚Ä¢ ${e.program} ‚Ä¢ ${formatDate(e.createdAt)}</div>\n            <div class="resource-actions">\n              <button class="btn btn-small" onclick="event.stopPropagation(); viewResource('${e.id}')">View</button>\n              <button class="btn-secondary btn-small" onclick="event.stopPropagation(); downloadResource('${e.id}')">Download</button>\n            </div>\n          </div>\n        `,t.appendChild(n)}));const s=document.getElementById("resourcesLoadMore");n.length>o.length?s.style.display="block":s.style.display="none"}function switchTab(e){document.querySelectorAll(".tab").forEach((e=>{e.classList.remove("active")})),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".section").forEach((e=>{e.style.display="none"}));document.getElementById({schools:"schoolsSection",resources:"resourcesSection",elearning:"elearningSection"}[e]).style.display="block"}function openAddModal(){document.getElementById("addModal").classList.add("show"),populateSchoolDropdown()}function closeModal(e){document.getElementById(e).classList.remove("show")}function populateSchoolDropdown(){const e=document.getElementById("resourceSchool");e.innerHTML='<option value="">Select school</option>',DATA.schools.forEach((t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.appendChild(n)}))}function updateProgramDropdown(e){const t=document.getElementById("resourceProgram");if(t.innerHTML='<option value="">Select program</option>',!e)return;const n=DATA.schools.find((t=>t.id===e));n&&n.programs.forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}))}function formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}async function loadResources(e=!1){try{let t=db.collection("resources").orderBy("createdAt","desc");e&&DATA.lastVisible&&(t=t.startAfter(DATA.lastVisible)),t=t.limit(DATA.resourcesLimit);const n=await t.get();e||(DATA.resources=[]),n.forEach((e=>{const t=e.data();t.id=e.id,t.createdAt&&t.createdAt.toDate?t.createdAt=t.createdAt.toDate().toISOString():t.createdAt||(t.createdAt=(new Date).toISOString()),DATA.resources.push(t)})),n.docs.length>0?(DATA.lastVisible=n.docs[n.docs.length-1],DATA.hasMoreResources=n.docs.length===DATA.resourcesLimit):DATA.hasMoreResources=!1,renderResources(e)}catch(e){showNotification("Error loading resources","error")}}function performSearch(){const e=document.getElementById("searchInput").value.toLowerCase().trim();if(!e)return renderSchools(),void renderResources();showSearchResults(DATA.schools.filter((t=>t.name.toLowerCase().includes(e)||t.programs.some((t=>t.toLowerCase().includes(e))))),DATA.resources.filter((t=>t.title.toLowerCase().includes(e)||t.course.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))),e)}function showSearchResults(e,t,n){switchTab("resources");const o=document.getElementById("resourcesList");o.innerHTML=`<h3 style="margin-bottom: 16px;">Search results for "${n}"</h3>`,0!==e.length||0!==t.length?(e.length>0&&(o.innerHTML+=`<h4 style="margin: 20px 0 12px; color: var(--muted);">Schools (${e.length})</h4>`,e.forEach((e=>{const t=document.createElement("div");t.className="resource-item",t.style.cursor="pointer",t.innerHTML=`\n            <div class="resource-icon">${e.icon}</div>\n            <div class="resource-content">\n              <div class="resource-title">${e.name}</div>\n              <div class="resource-meta">${e.programs.length} programs</div>\n            </div>\n          `,t.addEventListener("click",(()=>showSchoolDetails(e))),o.appendChild(t)}))),t.length>0&&(o.innerHTML+=`<h4 style="margin: 20px 0 12px; color: var(--muted);">Resources (${t.length})</h4>`,t.forEach((e=>{const t=document.createElement("div");t.className="resource-item",t.style.cursor="pointer",t.addEventListener("click",(()=>showProgramResources(e.program))),t.innerHTML=`\n            <div class="resource-icon">${getResourceIcon(e.type)}</div>\n            <div class="resource-content">\n              <div class="resource-title">${e.title}</div>\n              <div class="resource-meta">${e.course} ‚Ä¢ ${e.program}</div>\n              <div class="resource-actions">\n                <button class="btn btn-small" onclick="event.stopPropagation(); viewResource('${e.id}')">View</button>\n                <button class="btn-secondary btn-small" onclick="event.stopPropagation(); downloadResource('${e.id}')">Download</button>\n              </div>\n            </div>\n          `,o.appendChild(t)})))):o.innerHTML+='\n          <div class="empty-state">\n            <div class="empty-state-icon">üîç</div>\n            <h3>No results found</h3>\n            <p>Try different keywords</p>\n          </div>\n        '}function viewResource(e){const t=DATA.resources.find((t=>t.id===e));t&&t.fileURL?window.open(t.fileURL,"_blank"):showNotification("Resource not available","error")}function downloadResource(e){const t=DATA.resources.find((t=>t.id===e));if(t&&t.fileURL){const n=document.createElement("a");n.href=t.fileURL,n.download=t.fileName||"resource",document.body.appendChild(n),n.click(),document.body.removeChild(n),db.collection("resources").doc(e).update({downloads:firebase.firestore.FieldValue.increment(1),updatedAt:firebase.firestore.FieldValue.serverTimestamp()}),t.downloads=(t.downloads||0)+1,showNotification("Download started","success")}else showNotification("Resource not available","error")}function applyResourceFilter(e){DATA.currentFilter=e,document.querySelectorAll(".filter-btn").forEach((e=>{e.classList.remove("active")})),document.querySelector(`[data-type="${e}"]`).classList.add("active"),"none"!==document.getElementById("courseResourcesSection").style.display?renderCourseResources():renderResources()}function init(){function e(e){e.length>0&&(selectedFile=e[0],fileInfo.textContent=`${selectedFile.name} (${(selectedFile.size/1024/1024).toFixed(2)} MB)`)}renderSchools(),loadResources(),document.querySelectorAll(".tab").forEach((e=>{e.addEventListener("click",(()=>{switchTab(e.dataset.tab)}))})),document.getElementById("quickAddBtn").addEventListener("click",openAddModal),document.getElementById("closeModalBtn").addEventListener("click",(()=>closeModal("addModal"))),document.getElementById("closeSchoolModalBtn").addEventListener("click",(()=>closeModal("schoolModal"))),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&e.classList.remove("show")}))})),document.getElementById("searchBtn").addEventListener("click",performSearch),document.getElementById("searchInput").addEventListener("keypress",(e=>{"Enter"===e.key&&performSearch()})),document.getElementById("resourceSchool").addEventListener("change",(e=>{updateProgramDropdown(e.target.value)})),["dragenter","dragover","dragleave","drop"].forEach((e=>{dropArea.addEventListener(e,(e=>{e.preventDefault(),e.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((e=>dropArea.addEventListener(e,(()=>dropArea.classList.add("active"))))),["dragleave","drop"].forEach((e=>dropArea.addEventListener(e,(()=>dropArea.classList.remove("active"))))),dropArea.addEventListener("drop",(t=>e(t.dataTransfer.files))),dropArea.addEventListener("click",(()=>fileInput.click())),fileInput.addEventListener("change",(t=>e(t.target.files))),document.getElementById("addResourceForm").addEventListener("submit",(async e=>{if(e.preventDefault(),!selectedFile)return void showNotification("Please select a file","error");const t=document.getElementById("resourceSchool").value,n=DATA.schools.find((e=>e.id===t)),o={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,school:n?n.name:document.getElementById("resourceSchool").value,program:document.getElementById("resourceProgram").value,course:document.getElementById("resourceCourse").value,code:document.getElementById("resourceCode").value,description:document.getElementById("resourceDescription").value};if(o.title&&o.type&&o.school&&o.program&&o.course)try{await uploadFile(selectedFile,o)}catch(e){}else showNotification("Please fill all required fields","error")})),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(()=>{applyResourceFilter(e.dataset.type)}))})),document.querySelectorAll("#courseResourceFilters .filter-btn").forEach((e=>{e.addEventListener("click",(()=>{DATA.currentFilter=e.dataset.type,document.querySelectorAll("#courseResourceFilters .filter-btn").forEach((e=>{e.classList.remove("active")})),e.classList.add("active"),renderCourseResources()}))})),document.getElementById("backToResourcesBtn").addEventListener("click",(()=>{document.getElementById("courseResourcesSection").style.display="none",document.getElementById("resourcesSection").style.display="block",DATA.currentCourse=null})),document.getElementById("loadMoreResourcesBtn").addEventListener("click",(()=>{loadResources(!0)})),document.getElementById("loadMoreCourseResourcesBtn").addEventListener("click",(()=>{renderCourseResources(!0)})),showNotification("Welcome to DKUT Resource Centre!","success")}document.addEventListener("DOMContentLoaded",init);
